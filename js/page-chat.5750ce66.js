(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[30],{2425:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{ref:"chatPage",staticClass:"full-height full-width flex column bg-grey-4"},[a("q-header",{attrs:{elevated:""}},[a("q-toolbar",[a("q-btn",{directives:[{name:"go-back",rawName:"v-go-back",value:{name:e.$route.meta.backto,params:{slug:e.$route.params.slug}},expression:"{\n                name: $route.meta.backto,\n                params: { slug: $route.params.slug },\n            }"}],attrs:{flat:"",round:"",dense:"",icon:"eva-arrow-back-outline"}}),a("q-avatar",{directives:[{name:"go-back",rawName:"v-go-back",value:{name:e.$route.meta.backto,params:{slug:e.$route.params.slug}},expression:"{\n                name: $route.meta.backto,\n                params: { slug: $route.params.slug },\n            }"}],attrs:{size:"40px",color:"primary","text-color":"white"}},[a("img",{attrs:{src:e.urlPath+e.thumbnail.media}})]),a("div",{staticClass:" text-subtitle2 q-ml-sm"},[e._v(e._s(e.lelang.judul))]),a("q-space")],1),a("q-tabs",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[a("q-tab",{attrs:{name:"forum",label:"Forum"}}),a("q-tab",{attrs:{name:"users",label:"Users Forum"}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"forum"==e.tab,expression:"tab=='forum'"}],staticClass:"q-py-md"},[a("q-infinite-scroll",{ref:"infScroll",attrs:{offset:250,reverse:""},on:{load:e.onLoad},scopedSlots:e._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},e._l(e.array_tanggal,(function(t,s){return a("div",{key:"tgl"+s},[a("div",{staticClass:"flex flex-center text-center q-ma-sm"},[a("div",{staticClass:"tanggalan f-10"},[e._v(e._s(t))])]),a("div",{staticClass:"column reverse full-width",attrs:{id:"parent"}},e._l(e.filteredItems(t),(function(t,s){return a("div",{key:"item"+s,class:[e.user.id===t.user_id||"me"===t.user_name?"self-end":""]},[a("div",{staticClass:"q-mb-xs q-mx-xs",on:{click:function(a){return e.handleHold(t.id)}}},[a("div",{staticClass:"msg_cotainer_send",class:[e.user.id===t.user_id||"me"===t.user_name?"self":"another",{selected:t.id===e.isSelected}]},[e.user.id!=t.user_id&&"me"!=t.user_name?a("div",{staticClass:"msg_user f-10"},[e._v(e._s(t.user_name))]):e._e(),a("div",{staticClass:"column"},[e.replyUser(t.message)?a("span",{},[a("q-input",{staticClass:"full-width",attrs:{filled:"",dense:"",autogrow:"",value:e._f("text_reply")(t.message),"label-slot":""},scopedSlots:e._u([{key:"label",fn:function(){return[a("div",{staticClass:"row items-center all-pointer-events"},[a("q-icon",{staticClass:"q-mr-xs",attrs:{color:"deep-grey",size:"24px",name:"eva-corner-up-right-outline"}}),e._v("\n                                                            "+e._s(e._f("user_reply")(t.message))+"\n                                                        ")],1)]},proxy:!0}],null,!0)})],1):e._e(),a("span",{staticClass:"msg_text f-14"},[e._v(e._s(e._f("msg")(t.message)))])]),a("div",{staticClass:"msg_time row reverse f-10 text-right"},[0==t.status?a("div",[a("q-icon",{attrs:{name:"eva-clock-outline",color:"orange"}})],1):a("div",[a("q-icon",{attrs:{name:"eva-done-all",color:"orange",size:"xs"}})],1),a("div",{staticClass:"q-mr-xs",staticStyle:{opacity:"0.5"}},[e._v(e._s(e._f("jam")(t.created_at)))])])]),a("q-menu",{ref:"dialogRef",refInFor:!0,attrs:{"touch-position":"","context-menu":""}},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(a){return e.balasPesan(t)}}},[a("q-item-section",[a("div",{staticClass:"row"},[e._v("\n                                                Balas "),a("span",[a("q-icon",{staticClass:"q-ml-sm",attrs:{name:"eva-corner-up-right-outline"}})],1)])])],1),a("q-separator"),a("q-item",{attrs:{clickable:""}},[a("q-item-section",[e._v("Hapus")])],1)],1)],1)])})),0)])})),0)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"users"==e.tab,expression:"tab=='users'"}]},[a("CardUsers",{attrs:{users:e.users}})],1),a("q-footer",{staticClass:"bg-primary",attrs:{elevated:""}},[a("q-toolbar",{directives:[{name:"show",rawName:"v-show",value:e.reply.show,expression:"reply.show"}],staticClass:"bg-grey-2 q-pa-xs"},[a("q-input",{staticClass:"full-width",attrs:{filled:"",autogrow:"","label-slot":""},scopedSlots:e._u([{key:"label",fn:function(){return[a("div",{staticClass:"row items-center all-pointer-events"},[a("q-icon",{staticClass:"q-mr-xs",attrs:{color:"deep-grey",size:"24px",name:"eva-corner-up-right-outline"}}),e._v("\n                        "+e._s(e.reply.user)+"\n                    ")],1)]},proxy:!0},{key:"after",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"eva-close-outline",color:"black"},on:{click:e.closeReply}})]},proxy:!0}]),model:{value:e.reply.text,callback:function(t){e.$set(e.reply,"text",t)},expression:"reply.text"}})],1),a("q-toolbar",[a("q-input",{ref:"inputMessage",staticClass:"full-width",staticStyle:{"margin-bottom":"0px !important"},attrs:{outlined:"",autogrow:"",placeholder:"Tulis pesan",dense:"","bg-color":"white",rounded:"",loading:e.loading},scopedSlots:e._u([{key:"after",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"add",color:"white"},on:{click:e.bid}}),a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"send",color:"white"},on:{click:e.send}})]},proxy:!0}]),model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)],1)],1)},r=[],l=a("ded3"),i=a.n(l),n=a("2f62"),o=a("b166"),c=a("1ccd"),u=a("4d7a"),m=a("758b"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"full-width"},e._l(e.users,(function(t,s){return a("div",{key:"item"+s},[a("div",{staticClass:"row q-pa-md"},[a("div",{staticClass:"avatar q-mr-md"},[a("q-avatar",{attrs:{size:"50px",color:"primary","text-color":"white"}},[null!=t.avatar||void 0!=t.avatar?a("img",{attrs:{src:e.getAvatar(t.avatar)}}):a("span",[e._v(e._s(e._f("initial")(t.name)))])])],1),a("div",{staticClass:"column"},[a("div",{staticClass:"text-subtitle2 q-mt-xs"},[e._v(e._s(t.name))]),a("div",{staticClass:"text-caption"},[e._v(e._s(t.kota))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.id===e.user.id,expression:"item.id === user.id"}],staticClass:"col text-right"},[a("div",{staticClass:"q-mt-sm"},[a("q-btn",{attrs:{"no-caps":"",outline:"",rounded:"",color:"teal",size:"sm",label:"Pelelang"}})],1)])]),a("q-separator")],1)})),0)},p=[],g={props:{users:{type:Array,default:()=>[]}},created(){this.getLelangById(this.$route.params.slug)},filters:{initial(e){return e?e.substring(0,1):"G"}},computed:i()({urlPath(){return m["e"]()}},Object(n["c"])("lelang",["user"])),methods:i()(i()({},Object(n["b"])("lelang",["getLelangById"])),{},{getAvatar(e){var t=e.split("/"),a=t[0];return"images"===a?this.urlPath+e:e},getInitial(e){return e.name?e.name.substring(0,1):"G"}})},h=g,_=a("2877"),f=a("cb32"),v=a("9c40"),b=a("eb85"),y=a("eebe"),w=a.n(y),x=Object(_["a"])(h,d,p,!1,null,"56d4d05e",null),C=x.exports;w()(x,"components",{QAvatar:f["a"],QBtn:v["a"],QSeparator:b["a"]});var q={name:"PageChats",components:{CardUsers:C},data(){return{message:"",loading:!1,tab:"forum",page:1,lastPage:1,scrollTarget:void 0,spinn:!1,form:{message:"",id:null,lelang_id:null,created_at:null,updated_at_at:null,user_name:"",status:0},isSelected:null,reply:{show:!1,text:"",user:""}}},created(){this.getChat(this.page),this.getLelangById(this.$route.params.slug),this.scrollToBottom()},mounted(){},beforeDestroy(){this.clearChat()},filters:{ago(e){const t=parseInt(Object(o["a"])(new Date(e),"T"));return Object(c["a"])(t,{locale:u["a"]})},jam(e){return Object(o["a"])(new Date(e),"HH:mm")},tanggal(e){return Object(o["a"])(new Date(e),"PPPP",{locale:u["a"]})},msg(e){let t=e.split("_____");return t[0]},user_reply(e){let t=e.split("_____");return t[1]},text_reply(e){let t=e.split("_____");return t[2]}},computed:i()(i()(i()(i()({},Object(n["c"])("messaging",["progressDone","meta","themporary","chattings","array_tanggal","users"])),Object(n["c"])("users",["user","storage"])),Object(n["c"])("lelang",["lelangById","lelang","medias","nominalBid"])),{},{pageCount(){return Math.ceil(this.meta.total/this.meta.per_page)},pageOffset(){return this.meta.per_page*this.meta.current_page},urlPath(){return m["e"]()},thumbnail(){let e=[];this.lelang.media_lelang.map(((t,a)=>{e.push({media:this.lelang.media_lelang[a].image,status:this.lelang.media_lelang[a].status,video:!1})}));var t=e.filter((e=>1===e.status));return t.length>0?t[0]:e[0]}}),methods:i()(i()(i()({},Object(n["b"])("messaging",["createChat","getAllChat","clearChat","updateChattings","unshiftChat"])),Object(n["b"])("lelang",["getLelangById"])),{},{handleHold(e){},balasPesan(e){this.reply.show=!this.reply.show,this.reply.text=e.message,this.reply.user=e.user_name},closeReply(){this.reply.show=!this.reply.show},replyUser(e){let t=e.split("_____");return null!=t[1]||void 0!=t[1]},filteredItems(e){return this.chattings.filter((t=>Object(o["a"])(new Date(t.created_at),"PPPP",{locale:u["a"]}).indexOf(e)>-1))},onLoad(e,t,a){"users"!=this.tab?setTimeout((()=>{this.chattings&&(t(),this.page=e,console.log("onload index",e),e>=this.meta.last_page&&t(!0))}),2e3):t(!0)},getChat(e){this.spinn=!0;let t={params:{lelang_id:this.$route.params.slug,page:e}};this.getAllChat(t).then((()=>{this.lastPage=this.meta.last_page,this.spinn=!1}))},bid(){},send(){if(""==this.message)return void this.$refs.inputMessage.focus();var e;e=""!=this.reply.text&&""!=this.reply.user?this.message+"_____"+this.reply.user+"_____"+this.reply.text:this.message;let t={message:e,id:this.$route.params.slug,lelang_id:null,created_at:new Date,updated_at:new Date,user_name:"me",status:0};this.unshiftChat(t),this.reply.show=!1,this.loading=!0;let a={lelang_id:this.$route.params.slug,message:e};this.createChat(a).then((e=>{console.log("send post",e),this.loading=!1,this.message="",this.clearForm()})),this.scrollToBottom()},clearForm(){this.form.message="",this.form.id=null,this.form.lelang_id=null,this.form.created_at=null,this.form.updated_at=null,this.form.user_name="",this.form.status=0,this.reply.text="",this.reply.user=""},scrollToBottom(){setTimeout((()=>{let e=this.$refs.chatPage.$el;console.log("height ",e.scrollHeight),window.scrollTo(0,e.scrollHeight)}),20)}}),watch:{chattings(e){console.log("chattings",e)},page(e){if(console.log("page",e),1==e)return!1;this.getChat(this.page)},meta(e){console.log("watch meta",e.current_page),1==e.current_page&&(this.page=1,void 0!==this.$refs.infScroll&&this.$refs.infScroll.setIndex(1))},tab(e){console.log("watch tab",e),"users"==e?(this.page=1,this.$refs.infScroll.setIndex(1)):this.scrollToBottom()},lelang(e){console.log("watch lelang",e)}}},k=q,P=(a("c580"),a("9989")),$=a("e359"),Q=a("65c6"),S=a("2c91"),j=a("429b"),I=a("7460"),O=a("ef35"),B=a("27f9"),T=a("0016"),D=a("4e73"),H=a("66e5"),N=a("4074"),z=a("8380"),A=a("0d59"),F=a("7ff0"),L=a("2eeb"),U=a("714f"),M=a("7f67"),R=Object(_["a"])(k,s,r,!1,null,"1c95b5e8",null);t["default"]=R.exports;w()(R,"components",{QPage:P["a"],QHeader:$["a"],QToolbar:Q["a"],QBtn:v["a"],QAvatar:f["a"],QSpace:S["a"],QTabs:j["a"],QTab:I["a"],QInfiniteScroll:O["a"],QInput:B["a"],QIcon:T["a"],QMenu:D["a"],QItem:H["a"],QItemSection:N["a"],QSeparator:b["a"],QSpinnerDots:z["a"],QSpinner:A["a"],QFooter:F["a"]}),w()(R,"directives",{GoBack:L["a"],Ripple:U["a"],ClosePopup:M["a"]})},c2b2:function(e,t,a){},c580:function(e,t,a){"use strict";a("c2b2")}}]);